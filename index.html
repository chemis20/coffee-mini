<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>BrewPoint</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      margin: 0; padding: 12px;
      color: #fff;
      background: url('https://images.unsplash.com/photo-1509042239860-f550ce710b93?auto=format&fit=crop&w=1350&q=80') no-repeat center center/cover;
      height: 100vh;
      display: flex; flex-direction: column;
    }
    body::before {
      content: "";
      position: fixed;
      top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.55);
      z-index: -1;
    }
    h1 {
      text-align: center;
      color: #f7d7b5;
      font-weight: 700;
      font-size: 22px;
    }
    .section {
      margin-bottom: 24px;
    }
    .section h2 {
      color: #f7d7b5;
      margin: 0 0 12px 0;
      font-size: 18px;
    }
    .products {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .card {
      flex: 1 1 45%;
      max-width: 200px;
      background: rgba(255,255,255,0.9);
      border-radius: 18px;
      margin: 6px;
      box-shadow: 0 6px 14px rgba(0,0,0,.2);
      text-align: center;
      overflow: hidden;
      transition: transform .2s;
      color: #333;
    }
    .card img { width: 100%; height: 120px; object-fit: cover; }
    .card h3 { font-size: 15px; margin: 6px 0 2px; }
    .card p.desc { font-size: 12px; margin: 0 6px 6px; color: #555; }
    .card .price { font-weight: 700; color: #8b5e34; margin-bottom: 6px; }
    button {
      background: #a67c52;
      color: #fff; border: none;
      border-radius: 12px;
      padding: 8px 12px;
      font-size: 14px;
      margin-bottom: 8px;
    }
    button:hover { background: #8b5e34; }
    .modal {
      display: none;
      position: fixed;
      top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,.7);
      z-index: 999;
      overflow-y: auto;
      padding: 16px;
    }
    .modal-content {
      background: #fff;
      border-radius: 18px;
      padding: 18px;
      max-width: 400px;
      margin: 40px auto;
      text-align: center;
      color: #333;
    }
    .modal-content h3 { color: #6b4226; font-size: 18px; }
    .offer-btn {
      display: block; width: 100%;
      margin: 8px 0; padding: 12px;
      border-radius: 12px;
      font-size: 14px;
      background: #f1e1d0;
      border: 2px solid #a67c52;
      color: #6b4226;
      font-weight: 600;
    }
  </style>
</head>
<body>

<h1>–ú–µ–Ω—é BrewPoint</h1>

<!-- –ö–æ—Ñ–µ -->
<div class="section">
  <h2>–ö–æ—Ñ–µ</h2>
  <div class="products">
    <div class="card">
      <img src="https://images.unsplash.com/photo-1572442388796-11668a67e53d?auto=format&fit=crop&w=300&q=80">
      <h3>–õ–∞—Ç—Ç–µ</h3>
      <p class="desc">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –º–æ–ª–æ—á–Ω—ã–π –∫–æ—Ñ–µ</p>
      <p class="price">200‚ÇΩ</p>
      <button onclick="openModifiers('–õ–∞—Ç—Ç–µ',200)">–í –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
    <div class="card">
      <img src="https://images.unsplash.com/photo-1541167760496-1628856ab772?auto=format&fit=crop&w=300&q=80">
      <h3>–ö–∞–ø—É—á–∏–Ω–æ</h3>
      <p class="desc">–ù–∞—Å—ã—â–µ–Ω–Ω—ã–π –≤–∫—É—Å —Å –º–æ–ª–æ—á–Ω–æ–π –ø–µ–Ω–∫–æ–π</p>
      <p class="price">180‚ÇΩ</p>
      <button onclick="openModifiers('–ö–∞–ø—É—á–∏–Ω–æ',180)">–í –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
  </div>
</div>

<!-- –î–µ—Å–µ—Ä—Ç—ã -->
<div class="section">
  <h2>–î–µ—Å–µ—Ä—Ç—ã</h2>
  <div class="products">
    <div class="card">
      <img src="https://images.unsplash.com/photo-1587314168485-3236d6710814?auto=format&fit=crop&w=300&q=80">
      <h3>–ö—Ä—É–∞—Å—Å–∞–Ω</h3>
      <p class="desc">–•—Ä—É—Å—Ç—è—â–∏–π –∏ —Å–≤–µ–∂–∏–π</p>
      <p class="price">120‚ÇΩ</p>
      <button onclick="addToCart('–ö—Ä—É–∞—Å—Å–∞–Ω',120,'dessert')">–í –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
    <div class="card">
      <img src="https://images.unsplash.com/photo-1607478900766-efe13248b125?auto=format&fit=crop&w=300&q=80">
      <h3>–ß–∏–∑–∫–µ–π–∫</h3>
      <p class="desc">–ù–µ–∂–Ω—ã–π —Ç–≤–æ—Ä–æ–∂–Ω—ã–π –¥–µ—Å–µ—Ä—Ç</p>
      <p class="price">220‚ÇΩ</p>
      <button onclick="addToCart('–ß–∏–∑–∫–µ–π–∫',220,'dessert')">–í –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
  </div>
</div>

<!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
<div id="cart">
  <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
  <ul id="cart-list"></ul>
  <p>–ò—Ç–æ–≥–æ: <span id="total">0</span>‚ÇΩ</p>
  <button onclick="pay()">–û–ø–ª–∞—Ç–∏—Ç—å</button>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ -->
<div id="modModal" class="modal">
  <div class="modal-content">
    <h3>–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã</h3>
    <label><input type="checkbox" value="0" data-name="–°–∞—Ö–∞—Ä"> 1 –ª–æ–∂–∫–∞ —Å–∞—Ö–∞—Ä–∞ (+0‚ÇΩ)</label><br>
    <label><input type="checkbox" value="20" data-name="–í–∞–Ω–∏–ª—å"> –í–∞–Ω–∏–ª—å–Ω—ã–π (+20‚ÇΩ)</label><br>
    <label><input type="checkbox" value="20" data-name="–ö–∞—Ä–∞–º–µ–ª—å"> –ö–∞—Ä–∞–º–µ–ª—å–Ω—ã–π (+20‚ÇΩ)</label><br>
    <label><input type="checkbox" value="20" data-name="–®–æ–∫–æ–ª–∞–¥"> –®–æ–∫–æ–ª–∞–¥–Ω—ã–π (+20‚ÇΩ)</label><br>
    <button onclick="confirmModifiers()">–î–æ–±–∞–≤–∏—Ç—å</button>
    <button onclick="closeMod()">–û—Ç–º–µ–Ω–∞</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–ø–µ—Ü–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è -->
<div id="dessertOfferModal" class="modal">
  <div class="modal-content">
    <h3>–î–æ–±–∞–≤—å—Ç–µ –¥–µ—Å–µ—Ä—Ç –∏ –ø–æ–ª—É—á–∏—Ç–µ —Å–∫–∏–¥–∫—É üç∞</h3>
    <div id="dessertOptions"></div>
    <button onclick="skipDesserts()">–ù–µ—Ç, –ø–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è -->
<div id="checkoutModal" class="modal">
  <div class="modal-content">
    <h3>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–∫–∞–∑</h3>
    <ul id="finalList"></ul>
    <p><b>–°—É–º–º–∞:</b> <span id="finalTotal">0</span>‚ÇΩ</p>
    <button onclick="closeCheckout()">–í–µ—Ä–Ω—É—Ç—å—Å—è</button>
    <button onclick="fakePay()">–û–ø–ª–∞—Ç–∏—Ç—å</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É—Å–ø–µ—Ö–∞ -->
<div id="successModal" class="modal">
  <div class="modal-content">
    <h3>–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!</h3>
    <ul id="successList"></ul>
    <button onclick="closeMiniApp()">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ —á–∞—Ç</button>
  </div>
</div>

<script>
  let cart = [], discount = 0, currentItem = null;

  function openModifiers(name, price){
    currentItem = {name, basePrice: price};
    document.getElementById('modModal').style.display = 'block';
  }
  function closeMod(){ document.getElementById('modModal').style.display = 'none'; }
  function confirmModifiers(){
    const mods = Array.from(document.querySelectorAll('#modModal input:checked'))
      .map(cb => ({name: cb.dataset.name, price:+cb.value}));
    let finalPrice = currentItem.basePrice + mods.reduce((s,m)=>s+m.price,0);
    let itemName = currentItem.name + (mods.length ? ' ('+mods.map(m=>m.name).join(', ')+')' : '');
    addToCart(itemName, finalPrice, 'coffee');
    closeMod();
  }

  function addToCart(name, price, type){
    cart.push({name, price, type});
    updateCart();
  }
  function updateCart(){
    document.getElementById('cart-list').innerHTML = cart.map((i,idx)=>`<li>${i.name} ${i.price}‚ÇΩ <button onclick="removeItem(${idx})">√ó</button></li>`).join('');
    document.getElementById('total').textContent = calcTotal();
  }
  function removeItem(i){ cart.splice(i,1); updateCart(); }
  function calcTotal(){ 
    let sum = cart.reduce((s,i)=>s+i.price,0);
    return discount>0 ? Math.round(sum*(1-discount/100)) : sum;
  }

  function pay(){
    if(cart.length===0){ alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'); return; }
    if(!cart.some(i=>i.type==='dessert')){ showDessertOffer(); return; }
    showCheckout();
  }

  function showDessertOffer(){
    let base = cart.reduce((s,i)=>s+i.price,0);
    let oneDessert = base+120, twoDesserts = base+120+220;
    document.getElementById('dessertOptions').innerHTML = `
      <button class="offer-btn" onclick="chooseDesserts(['–ö—Ä—É–∞—Å—Å–∞–Ω'],10,${oneDessert})">–í–∞—à –∑–∞–∫–∞–∑ + –ö—Ä—É–∞—Å—Å–∞–Ω = ${Math.round(oneDessert*0.9)}‚ÇΩ (‚Äì10%)</button>
      <button class="offer-btn" onclick="chooseDesserts(['–ß–∏–∑–∫–µ–π–∫'],10,${base+220})">–í–∞—à –∑–∞–∫–∞–∑ + –ß–∏–∑–∫–µ–π–∫ = ${Math.round((base+220)*0.9)}‚ÇΩ (‚Äì10%)</button>
      <button class="offer-btn" onclick="chooseDesserts(['–ö—Ä—É–∞—Å—Å–∞–Ω','–ß–∏–∑–∫–µ–π–∫'],15,${twoDesserts})">–í–∞—à –∑–∞–∫–∞–∑ + 2 –¥–µ—Å–µ—Ä—Ç–∞ = ${Math.round(twoDesserts*0.85)}‚ÇΩ (‚Äì15%)</button>
    `;
    document.getElementById('dessertOfferModal').style.display='block';
  }
  function chooseDesserts(arr, disc, total){
    discount=disc;
    arr.forEach(d=>cart.push({name:d+' (–∫–æ–º–±–æ)', price:(d==='–ö—Ä—É–∞—Å—Å–∞–Ω'?120:220), type:'dessert'}));
    document.getElementById('dessertOfferModal').style.display='none';
    updateCart(); showCheckout();
  }
  function skipDesserts(){ discount=0; document.getElementById('dessertOfferModal').style.display='none'; showCheckout(); }

  function showCheckout(){
    document.getElementById('finalList').innerHTML=cart.map(i=>`<li>${i.name} ${i.price}‚ÇΩ</li>`).join('');
    document.getElementById('finalTotal').textContent=calcTotal();
    document.getElementById('checkoutModal').style.display='block';
  }
  function closeCheckout(){ document.getElementById('checkoutModal').style.display='none'; }
  function fakePay(){
    document.getElementById('successList').innerHTML=document.getElementById('finalList').innerHTML;
    document.getElementById('checkoutModal').style.display='none';
    document.getElementById('successModal').style.display='block';
    Telegram.WebApp.sendData(JSON.stringify({command:'order', items:cart, total:calcTotal(), address:"—É–ª. –õ–µ–Ω–∏–Ω–∞, 10"}));
  }
  function closeMiniApp(){ Telegram.WebApp.close(); }
</script>
</body>
</html>
