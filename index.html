<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>BrewPoint</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
    :root {
      --bg: #0f0e0d;
      --text: #f7f3ee;
      --muted: #cfc8c0;
      --brand: #b7895b;
      --brand-dark:#8b5e34;
      --card: rgba(255,255,255,0.08);
      --shadow: 0 10px 30px rgba(0,0,0,.25);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);color:var(--text);min-height:100dvh;
      -webkit-font-smoothing:antialiased;
      padding-bottom:env(safe-area-inset-bottom);
    }

    .bg{
      position:fixed;inset:0;
      background:linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,.75)),
                 url('https://images.unsplash.com/photo-1494415859740-21e878dd929d?q=80&w=1800&auto=format&fit=crop');
      background-size:cover;background-position:center;
      z-index:-1;
    }

    .wrap{width:100%;max-width:900px;margin:0 auto;padding:16px 16px 28px;}

    header{padding:8px 0 6px;display:flex;align-items:center;justify-content:space-between;}
    .brand{font-weight:700;font-size:22px}
    .pill{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.12);
          padding:6px 12px;border-radius:999px;box-shadow:var(--shadow);
          font-size:13px;color:var(--muted)}

    h1{font-size:24px;margin:16px 0 8px}
    .section-title{font-size:18px;margin:10px 4px 10px;color:#f0e8df;font-weight:600}

    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media(min-width:480px){.grid{grid-template-columns:repeat(3,1fr);gap:14px}}

    .card{background:var(--card);border:1px solid rgba(255,255,255,.12);
          border-radius:var(--radius);overflow:hidden;backdrop-filter:blur(8px);
          box-shadow:var(--shadow);display:flex;flex-direction:column;}
    .thumb{width:100%;aspect-ratio:1/1;object-fit:cover}
    .card-body{padding:10px;display:flex;flex-direction:column;flex:1}
    .card h3{margin:0 0 4px;font-size:15.5px}
    .desc{margin:0 0 8px;color:var(--muted);font-size:12.5px;line-height:1.3em;min-height:2.6em}
    .row{margin-top:auto;display:flex;align-items:center;justify-content:space-between}
    .price{color:var(--brand);font-weight:700;font-size:15.5px}
    .btn{background:var(--brand);color:#fff;border:none;border-radius:12px;
         padding:8px 12px;font-size:14px;font-weight:600;cursor:pointer;
         transition:.15s;box-shadow:var(--shadow)}
    .btn:hover{background:var(--brand-dark)}

    #cart{position:sticky;bottom:0;background:rgba(24,23,22,.9);backdrop-filter:blur(10px);
          border-top:1px solid rgba(255,255,255,.12);
          padding:12px 12px calc(12px + env(safe-area-inset-bottom));
          margin-top:18px;border-radius:16px 16px 0 0;box-shadow:0 -10px 30px rgba(0,0,0,.35)}
    #cart h2{margin:0 0 8px;font-size:17px}
    #cart-list{list-style:none;margin:0 0 8px;padding:0;max-height:26vh;overflow:auto}
    #cart-list li{font-size:14px;margin:6px 0;display:flex;align-items:center;justify-content:space-between;gap:8px}
    .rem{background:#e74c3c;color:#fff;border:none;border-radius:8px;padding:4px 8px;font-size:12px}

    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1000;padding:16px}
    .modal-content{position:relative;width:100%;max-width:520px;margin:auto;
                   background:#1b1917;color:var(--text);border-radius:22px;padding:18px 16px;
                   border:1px solid rgba(255,255,255,.12);box-shadow:var(--shadow)}
    .modal h3{margin:2px 0 12px;font-size:18px}
    .close-x{position:absolute;top:10px;right:12px;font-size:20px;background:none;border:none;color:#fff;opacity:.7}

    .mods{padding-left:0;margin-left:0}
    .mod-item{display:flex;align-items:center;gap:10px;padding:6px 0}
    .mod-item input{width:18px;height:18px;accent-color:var(--brand)}
    .mod-label{font-size:14.5px;color:#e9e2da}
    .muted{color:var(--muted);font-size:13px}

    .time-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin:8px 0}
    .time-btn{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);
              padding:10px 8px;border-radius:12px;font-weight:600;color:#fff}

    .upsell-box{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.12);
                border-radius:18px;padding:14px;margin-top:8px}
    .deal{display:flex;justify-content:space-between;align-items:center;gap:10px;
          background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.1);
          border-radius:14px;padding:10px}
    .deal strong{font-size:15px}
    .deal .small{font-size:12.5px;color:var(--muted)}

    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn-ghost{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.2);
               color:#fff;border-radius:12px;padding:8px 12px;font-weight:600}

    .pay-row{display:flex;align-items:center;justify-content:space-between;margin-top:10px}
    .total{font-weight:800;font-size:18px}
  </style>
</head>
<body>
  <div class="bg"></div>
  <div class="wrap">
    <header>
      <div class="brand">BrewPoint</div>
      <div class="pill">Сегодня: 08:00–21:00</div>
    </header>

    <h1>Меню</h1>

    <!-- Кофе -->
    <div class="section">
      <div class="section-title">Кофе</div>
      <div class="grid">
        <div class="card">
          <img class="thumb" src="https://images.unsplash.com/photo-1572442388796-11668a67e53d?auto=format&fit=crop&w=600&q=80">
          <div class="card-body">
            <h3>Латте</h3>
            <p class="desc">Мягкий молочный кофе</p>
            <div class="row">
              <div class="price">200₽</div>
              <button class="btn" onclick="openMods('Латте',200)">В корзину</button>
            </div>
          </div>
        </div>
        <div class="card">
          <img class="thumb" src="https://images.unsplash.com/photo-1541167760496-1628856ab772?auto=format&fit=crop&w=600&q=80">
          <div class="card-body">
            <h3>Капучино</h3>
            <p class="desc">Насыщенный с молочной пенкой</p>
            <div class="row">
              <div class="price">180₽</div>
              <button class="btn" onclick="openMods('Капучино',180)">В корзину</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Десерты -->
    <div class="section">
      <div class="section-title">Десерты</div>
      <div class="grid">
        <div class="card">
          <img class="thumb" src="https://images.unsplash.com/photo-1587314168485-3236d6710814?auto=format&fit=crop&w=600&q=80">
          <div class="card-body">
            <h3>Круассан</h3>
            <p class="desc">Тёплый, слоёный</p>
            <div class="row">
              <div class="price">120₽</div>
              <button class="btn" onclick="addToCart('Круассан',120)">В корзину</button>
            </div>
          </div>
        </div>
        <div class="card">
          <img class="thumb" src="https://images.unsplash.com/photo-1607478900766-efe13248b125?auto=format&fit=crop&w=600&q=80">
          <div class="card-body">
            <h3>Чизкейк</h3>
            <p class="desc">Нежный творожный</p>
            <div class="row">
              <div class="price">220₽</div>
              <button class="btn" onclick="addToCart('Чизкейк',220)">В корзину</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Корзина -->
    <div id="cart">
      <h2>Корзина</h2>
      <ul id="cart-list"></ul>
      <div class="pay-row">
        <div class="total">Итого: <span id="total">0</span>₽</div>
        <button class="btn" onclick="pay()">Оплатить</button>
      </div>
    </div>
  </div>

  <!-- Модалка модификаторов -->
  <div id="modsModal" class="modal"><div class="modal-content">
    <button class="close-x" onclick="hide('modsModal')">×</button>
    <h3>Выберите модификаторы</h3>
    <div id="modsList"></div>
    <div class="actions">
      <button class="btn" onclick="confirmMods()">Далее</button>
    </div>
  </div></div>

  <!-- Модалка проверки -->
  <div id="checkoutModal" class="modal"><div class="modal-content">
    <button class="close-x" onclick="hide('checkoutModal')">×</button>
    <h3>Проверьте заказ</h3>
    <ul id="finalList"></ul>
    <p><b>Итого:</b> <span id="finalTotal">0</span>₽</p>
    <div class="actions">
      <button class="btn" onclick="fakePay()">Оплатить</button>
    </div>
  </div></div>

  <!-- Модалка успеха -->
  <div id="successModal" class="modal"><div class="modal-content">
    <h3>Заказ оформлен!</h3>
    <ul id="successList"></ul>
    <button class="btn" onclick="closeMiniApp()">Вернуться в чат</button>
  </div></div>

<script>
Telegram.WebApp.ready();

// --- данные модификаторов
const MODS = [
  {id:'sugar',title:'1 ложка сахара',add:0},
  {id:'vanilla',title:'Ванильный сироп',add:20},
  {id:'caramel',title:'Карамельный сироп',add:20},
  {id:'choco',title:'Шоколадный сироп',add:20}
];

let cart=[]; let currentItem=null;

function $(id){return document.getElementById(id)}
function show(id){$(id).style.display='block'}
function hide(id){$(id).style.display='none'}

function updateCart(){
  $("cart-list").innerHTML=cart.map((i,idx)=>`<li>${i.name} ${i.price}₽ <button class="rem" onclick="removeItem(${idx})">×</button></li>`).join('');
  $("total").textContent=cart.reduce((s,i)=>s+i.price,0);
}

function addToCart(name,price){
  cart.push({name,price});
  updateCart();
}

function removeItem(idx){cart.splice(idx,1);updateCart()}

// --- модификаторы
function openMods(name,price){
  currentItem={name,basePrice:price};
  $("modsList").innerHTML=MODS.map(m=>`
    <div class="mod-item">
      <input type="checkbox" id="m_${m.id}" data-add="${m.add}">
      <label for="m_${m.id}" class="mod-label">${m.title} ${m.add?`(+${m.add}₽)`:''}</label>
    </div>`).join('');
  show("modsModal");
}
function confirmMods(){
  let add=0; let mods=[];
  MODS.forEach(m=>{
    const el=document.getElementById("m_"+m.id);
    if(el.checked){add+=+el.dataset.add;mods.push(m.title)}
  });
  const finalName=currentItem.name+(mods.length?" ("+mods.join(", ")+")":"");
  const finalPrice=currentItem.basePrice+add;
  addToCart(finalName,finalPrice);
  hide("modsModal");
}

// --- оплата
function pay(){
  if(cart.length===0){alert("Корзина пуста");return;}
  $("finalList").innerHTML=cart.map(i=>`<li>${i.name} — ${i.price}₽</li>`).join('');
  $("finalTotal").textContent=cart.reduce((s,i)=>s+i.price,0);
  show("checkoutModal");
}
function fakePay(){
  hide("checkoutModal");
  $("successList").innerHTML=cart.map(i=>`<li>${i.name} — ${i.price}₽</li>`).join('');
  show("successModal");
}

// --- отправка в бот
function closeMiniApp(){
  const payload={
    command:"order",
    order_id:Math.floor(Math.random()*90000)+10000,
    tg_user_id:Telegram.WebApp.initDataUnsafe?.user?.id,
    items:cart,
    total:cart.reduce((s,i)=>s+i.price,0)
  };
  Telegram.WebApp.sendData(JSON.stringify(payload));
  Telegram.WebApp.close();
}
</script>
</body>
</html>
