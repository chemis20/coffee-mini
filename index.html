<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>BrewPoint</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
    body {background:#f7f3ee;font-family:'Inter',sans-serif;margin:0;padding:16px;color:#333}
    .section{margin-bottom:24px}
    .section h2{color:#8b5e34;font-weight:600;margin:0 0 12px 0}
    .card{width:46%;max-width:200px;background:#fff;border-radius:16px;display:inline-block;margin:2%;box-shadow:0 4px 12px rgba(0,0,0,.08);vertical-align:top}
    .card img{width:100%;height:120px;object-fit:cover;border-radius:16px 16px 0 0}
    .card-content{padding:8px;display:flex;flex-direction:column;justify-content:space-between;height:140px}
    .card h3{margin:0;font-size:15px;font-weight:600}
    .card p.desc{font-size:12px;color:#555;margin:4px 0 8px}
    .price-btn{margin-top:auto;display:flex;justify-content:space-between;align-items:center}
    .price{font-weight:600;color:#8b5e34}
    button{background:#a67c52;color:#fff;border:none;border-radius:12px;padding:6px 10px;font-size:13px;cursor:pointer;transition:.2s}
    button:hover{background:#8b5e34}
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);z-index:999;overflow:auto}
    .modal-content{background:#fff;border-radius:20px;padding:20px;margin:40px auto;max-width:90%;box-shadow:0 8px 24px rgba(0,0,0,.15)}
    #cart{background:#fff;padding:16px;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,.08)}
    #cart ul{padding-left:18px}
  </style>
</head>
<body>

<h1>Меню BrewPoint</h1>

<!-- Кофе -->
<div class="section">
  <h2>Кофе</h2>
  <div class="card">
    <img src="https://images.unsplash.com/photo-1572442388796-11668a67e53d?auto=format&fit=crop&w=300&q=80">
    <div class="card-content">
      <h3>Латте</h3>
      <p class="desc">Классический молочный кофе</p>
      <div class="price-btn">
        <span class="price">200₽</span>
        <button onclick="openModal('Латте',200)">В корзину</button>
      </div>
    </div>
  </div>
  <div class="card">
    <img src="https://images.unsplash.com/photo-1541167760496-1628856ab772?auto=format&fit=crop&w=300&q=80">
    <div class="card-content">
      <h3>Капучино</h3>
      <p class="desc">Насыщенный вкус с молочной пенкой</p>
      <div class="price-btn">
        <span class="price">180₽</span>
        <button onclick="openModal('Капучино',180)">В корзину</button>
      </div>
    </div>
  </div>
</div>

<!-- Десерты -->
<div class="section">
  <h2>Десерты</h2>
  <div class="card">
    <img src="https://images.unsplash.com/photo-1587314168485-3236d6710814?auto=format&fit=crop&w=300&q=80">
    <div class="card-content">
      <h3>Круассан</h3>
      <p class="desc">Слоёное тесто с хрустящей корочкой</p>
      <div class="price-btn">
        <span class="price">120₽</span>
        <button onclick="addToCart('Круассан',120)">В корзину</button>
      </div>
    </div>
  </div>
  <div class="card">
    <img src="https://images.unsplash.com/photo-1607478900766-efe13248b125?auto=format&fit=crop&w=300&q=80">
    <div class="card-content">
      <h3>Чизкейк</h3>
      <p class="desc">Нежный творожный десерт</p>
      <div class="price-btn">
        <span class="price">220₽</span>
        <button onclick="addToCart('Чизкейк',220)">В корзину</button>
      </div>
    </div>
  </div>
</div>

<!-- Модальное окно модификаторов -->
<div id="modal" class="modal">
  <div class="modal-content">
    <h3>Выберите модификаторы</h3>
    <label><input type="checkbox" id="sugar"> 1 ложка сахара (+0₽)</label><br>
    <label><input type="checkbox" id="vanilla"> Ванильный (+20₽)</label><br>
    <label><input type="checkbox" id="caramel"> Карамельный (+20₽)</label><br>
    <label><input type="checkbox" id="chocolate"> Шоколадный (+20₽)</label><br>
    <button onclick="confirmModal()">Далее к времени</button>
    <button onclick="closeModal()">Отмена</button>
  </div>
</div>

<!-- Модальное окно времени -->
<div id="timeModal" class="modal">
  <div class="modal-content">
    <h3>Когда приготовить?</h3>
    <button class="time-btn" onclick="selectTime('Сейчас')">В ближайшее время</button>
    <button class="time-btn" onclick="selectTime('Через 30 мин')">Через 30 минут</button>
    <button class="time-btn" onclick="selectTime('Через 1 час')">Через 1 час</button>
    <label>Свой вариант: <input type="time" id="customTime"></label>
    <button onclick="selectCustom()">Свой вариант</button>
  </div>
</div>

<!-- Корзина -->
<div id="cart">
  <h2>Корзина</h2>
  <ul id="cart-list"></ul>
  <p id="timeLine">Время: не выбрано</p>
  <p>Итого: <span id="total">0</span>₽</p>
  <button onclick="pay()">Оплатить</button>
</div>

<!-- Модальное окно «Проверьте заказ» -->
<div id="checkoutModal" class="modal">
  <div class="modal-content">
    <h3>Проверьте заказ</h3>
    <p><b>Адрес кофейни:</b> ул. Ленина, 10 (BrewPoint)</p>
    <ul id="finalList"></ul>
    <p><b>Сумма:</b> <span id="finalTotal">0</span>₽</p>
    <p><b>Время:</b> <span id="finalTime">—</span></p>
    <button onclick="closeCheckout()">Вернуться к каталогу</button>
    <button onclick="fakePay()">Оплатить</button>
  </div>
</div>

<!-- Модальное окно «Заказ оформлен» -->
<div id="successModal" class="modal">
  <div class="modal-content">
    <h3>Заказ оформлен!</h3>
    <ul id="successList"></ul>
    <p>Номер заказа: #<span id="orderNumber">12345</span></p>
    <button onclick="closeMiniApp()">Вернуться в чат</button>
  </div>
</div>

<script>
  let cart = [];
  let selectedTime = null;
  let currentItem = null;

  function openModal(name, price){
    currentItem = {name, price};
    document.getElementById('modal').style.display = 'block';
  }
  function closeModal(){document.getElementById('modal').style.display = 'none';}
  function confirmModal(){
    let total = currentItem.price;
    const mods = [];
    if(document.getElementById('sugar').checked) mods.push('сахар');
    if(document.getElementById('vanilla').checked){ mods.push('ваниль'); total += 20; }
    if(document.getElementById('caramel').checked){ mods.push('карамель'); total += 20; }
    if(document.getElementById('chocolate').checked){ mods.push('шоколад'); total += 20; }
    const name = currentItem.name + (mods.length ? ' (' + mods.join(', ') + ')' : '');
    currentItem = {name, price: total};
    closeModal(); openTimeModal();
  }

  function openTimeModal(){document.getElementById('timeModal').style.display = 'block';}
  function closeTimeModal(){document.getElementById('timeModal').style.display = 'none';}
  function selectTime(time){selectedTime = time; addToCart(currentItem.name, currentItem.price); closeTimeModal();}
  function selectCustom(){
    const val = document.getElementById('customTime').value;
    if (!val) { alert('Укажите время'); return; }
    selectedTime = val; addToCart(currentItem.name, currentItem.price); closeTimeModal();
  }

  function addToCart(name, price){
    cart.push({name, price, time: selectedTime});
    updateCart();
  }
  function updateCart(){
    const list=document.getElementById('cart-list');
    list.innerHTML='';
    cart.forEach((item, idx)=>list.innerHTML+=`<li>${item.name} ${item.price}₽ – ${item.time} <button onclick="removeItem(${idx})" style="margin-left:8px;background:#e74c3c;color:#fff;border:none;border-radius:6px;padding:2px 6px;font-size:12px">×</button></li>`);
    document.getElementById('total').textContent = cart.reduce((s,i)=>s+i.price,0);
    document.getElementById('timeLine').textContent = `Время: ${selectedTime || 'не выбрано'}`;
  }
  function removeItem(index){cart.splice(index, 1); updateCart();}

  function pay(){
    if(cart.length === 0){ alert('Корзина пуста'); return; }
    document.getElementById('finalList').innerHTML = cart.map(i => `<li>${i.name} ${i.price}₽ – ${i.time}</li>`).join('');
    document.getElementById('finalTotal').textContent = cart.reduce((s,i)=>s+i.price,0);
    document.getElementById('finalTime').textContent = selectedTime || '—';
    document.getElementById('checkoutModal').style.display = 'block';
  }
  function fakePay(){
    document.getElementById('successList').innerHTML = cart.map(i => `<li>${i.name} ${i.price}₽ – ${i.time}</li>`).join('');
    document.getElementById('orderNumber').textContent = Math.floor(Math.random()*90000)+10000;
    document.getElementById('checkoutModal').style.display = 'none';
    document.getElementById('successModal').style.display = 'block';
  }
  function closeCheckout(){document.getElementById('checkoutModal').style.display = 'none';}

  function closeMiniApp(){
    const payload = {
      command: "order",
      items: cart,
      total: cart.reduce((s,i)=>s+i.price,0),
      time: selectedTime
    };
    try { Telegram.WebApp.sendData(JSON.stringify(payload)); } catch(e){ console.warn(e); }
    setTimeout(()=>{ Telegram.WebApp.close(); }, 400);
  }
</script>
</body>
</html>
